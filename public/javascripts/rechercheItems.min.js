$(document).ready(function(){function e(){var e=jsRoutes.controllers.Reps.findAll(),t=$.getJSON(e.url,function(e){i(e)}).fail(function(e,t,i){var n=t+", "+i;console.log("Request Failed: "+n)});e=jsRoutes.controllers.Clients.findAll();var o=$.getJSON(e.url,function(e){n(e)}).fail(function(e,t,i){var n=t+", "+i;console.log("Request Failed: "+n)});$.when(t,o).done(function(){c()})}function t(e,t,i){var n=$("#"+e).html(),o=Handlebars.compile(n),l=o(t);$("#"+i).html(l)}function i(e){t("rep-select-template",{rep:e},"selectRepresentant"),$("#selectRepresentant").css("width","200px")}function n(e){t("client-select-template",{client:e},"selectClient"),$("#selectClient").css("width","200px")}function o(){$("#listeItems").empty(),$("#listeSoumissions").empty(),$("a#ajoutItems").addClass("hidden")}function l(e,t,i){$("#"+t+":checkbox").prop("checked",e),1==e?$("#"+i).removeClass("uncheckedLabel"):$("#"+i).addClass("uncheckedLabel")}function c(){$("#selectClient").change(function(){l(!0,"filtreClient","divFiltreClient"),s()}),$("#selectRepresentant").change(function(){var e=$(this).val();null==e||"NA"===e?l(!1,"filtreVendeur","divFiltreVendeur"):l(!0,"filtreVendeur","divFiltreVendeur"),s()}),$("#filtreClient:checkbox").click(function(){$("#divFiltreClient").toggleClass("uncheckedLabel"),s()}),$("#filtreVendeur:checkbox").click(function(){$("#divFiltreVendeur").toggleClass("uncheckedLabel"),s()})}function a(e){e?$("div#filtres").removeClass("hidden"):$("div#filtres").addClass("hidden")}function s(e){var t=$("select#fieldSelect option:selected").val(),i=$("input#inputTextKeyword").val().length;if(i>2){var n=$("input[name='choixItemSoum']:checked").attr("id"),l=$("input[name='choixItemSoum']:checked").val(),c=$("input#inputTextKeyword").val();l+="search/";var a="?value="+c+"&field="+t;$("#filtreDate").prop("checked")?(a+="&"+$("#dateDebut").serialize(),a+="&"+$("#dateFin").serialize()):a+="&dateDebut=&dateFin=",a+=$("#filtreClient").prop("checked")?"&"+$("#selectClient").serialize():"&selectClient=",a+=$("#filtreVendeur").prop("checked")?"&"+$("#selectRepresentant").serialize():"&selectRepresentant=",$.get(l+a,function(e){"choixItem"==n?u("#listeItems","Items trouvés",e):p("#listeSoumissions","Soumissions trouvées",e)}).fail(function(){console.log("Request failed")})}else o()}function d(e){var t=$("select#listeSoum option:selected").val(),i=$("input#choixItem").val();i+=t,$.get(i,function(e){u("#listeItems","Items trouvés",e)}).fail(function(){console.log("Request failed")})}function r(e){e.preventDefault();var t=$("input:checkbox:checked").serializeArray();if(t.length>0){var i=$("a#ajoutItems").prop("href");$.ajax({type:"POST",url:i,data:t,success:function(e){console.log(e),window.location.href=$("a#mesItemsLink").prop("href")}})}}function u(e,t,i){$(e).empty(),$(e).append("<h3>"+t+"</h3>");var n="<p class='bg-info'>La recherche a retourné "+i.length;if(n+=i.length>1?" items.</p>":" item.</p>",$(e).append(n),i.length>0){var o="<button id='checkAll' class='btn btn-default espace'>Cocher tous</button><button id='checkNone' class='btn btn-default espace'>Cocher aucun</button>";o+="<div class='table-responsive'>",o+="<table class='table table-striped'>",$.each(i,function(e,t){0==e&&(o+="<thead><tr>",o+="<th></th>",o+="<th>Numéro</th><th>Nom Item</th><th>Description</th><th>Largeur</th><th>Hauteur</th>",o+="<th>Famille</th><th>Source Prod</th><th>NoSoum</th>",o+="</tr></thead>",o+="<tbody>"),o+="<tr>",o+="<td><input type='checkbox' name='NoItem' value="+t.noItem+" /></td>",o+="<td>"+t.noItem+"</td>",o+="<td>"+t.nomItem+"</td>",o+="<td>"+t.description+"</td>",o+="<td>"+t.largeur+"</td>",o+="<td>"+t.hauteur+"</td>",o+="<td>"+t.famille+"</td>",o+="<td>"+t.sourceProd+"</td>",o+="<td>"+t.noSoumission+"</td>",o+="</tr>"}),o+="</tbody></table>",o+="</div>",$(e).append(o),$("a#ajoutItems").removeClass("hidden"),$("input:checkbox").click(function(){$("input:checkbox:checked").length>0?$("a#ajoutItems").removeClass("disabled"):$("a#ajoutItems").addClass("disabled")}),$("#checkAll").click(function(){$("input:checkbox[name*='NoItem']").prop("checked",!0),$("a#ajoutItems").removeClass("disabled")}),$("#checkNone").click(function(){$("input:checkbox[name*='NoItem']").prop("checked",!1),$("a#ajoutItems").addClass("disabled")})}else $("a#ajoutItems").addClass("hidden")}function p(e,t,i){o(),$(e).append("<h3>"+t+"</h3>");var n="<p class='bg-info'>La recherche a retourné "+i.length;if(n+=i.length>1?" soumissions.</p>":" soumission.</p>",$(e).append(n),i.length>0){var l="<select id='listeSoum' required='required' size=10>";$.each(i,function(e,t){l+=0==e?"<option selected='selected' value="+t.noSoumission+">":"<option value="+t.noSoumission+">",l+=t.suite+"-"+t.version+", Client : "+t.clientSoum+", Projet : "+t.projet,l+="</option>"}),l+="</select>",$(e).append(l),$("select#listeSoum").bind("change",d),d()}}e(),$.datepicker.setDefaults($.datepicker.regional["fr-CA"]),$(".mydatepicker").datepicker({changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd"}),$(".mydatepicker").datepicker("option","disabled",!0),$(document).ajaxStart(function(){$("#loadingDiv").css("display","inline-block")}),$(document).ajaxComplete(function(){$("#loadingDiv").css("display","none")}),$("#filtreDate:checkbox").click(function(){$(this).prop("checked")?($(".mydatepicker").datepicker("option","disabled",!1),$(".ui-datepicker").css("margin-left","-50px","margin-top","-50px")):$(".mydatepicker").datepicker("option","disabled",!0),$("#divFiltreDate").toggleClass("uncheckedLabel"),s()}),$("#dateDebut").change(function(){var e=$(this).datepicker("getDate");$("#dateFin").datepicker("option","minDate",e),l(!0,"filtreDate","divFiltreDate"),s()}),$("#dateFin").change(function(){var e=$(this).datepicker("getDate");$("#dateDebut").datepicker("option","maxDate",e),l(!0,"filtreDate","divFiltreDate"),s()}),$("input[name='choixItemSoum']").click(function(){if(o(),$("select#fieldSelect").empty(),$(this).prop("checked")&&"choixSoum"==$(this).attr("id")){var e="<option value='Suite' selected='selected'>Numéro de soumission</option>";e+="<option value='Projet'>Projet</option>",e+="<option value='Client'>Client</option>",e+="<option value='all'>Tout</option>",$("select#fieldSelect").html(e),a(!0)}else if($(this).prop("checked")&&"choixItem"==$(this).attr("id")){var e="<option value='all' selected='selected'>Tout</option>";e+="<option value='NoItem'>No Item</option>",e+="<option value='NomItem'>Nom Item</option>",e+="<option value='Description'>Description</option>",$("select#fieldSelect").html(e),a(!1)}s()}),$("input#inputTextKeyword").bind("keyup",s),$("select#fieldSelect").bind("change",s),$("a#ajoutItems").bind("click",r)});